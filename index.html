<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Angel-åè¦‹è¦ºå¯Ÿ</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            color-scheme: light;
            --bg-start: #F9F5F0; --bg-end: #F2E9E1;
            --text-main: #5D5245; --accent-soft: #B99B6B;
            --white: rgba(255, 255, 255, 0.98);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; font-family: "PingFang TC", "Noto Sans TC", sans-serif;
            height: 100dvh; background: linear-gradient(135deg, var(--bg-start), var(--bg-end)) !important;
            color: var(--text-main) !important; display: flex; justify-content: center; overflow: hidden;
        }
        .container { 
            width: 100%; max-width: 480px; height: 100dvh; 
            padding: 20px 25px; display: flex; flex-direction: column; 
            align-items: center; justify-content: space-between; 
            padding-bottom: calc(env(safe-area-inset-bottom) + 20px); 
        }
        .page { width: 100%; animation: fadeIn 0.6s ease; display: none; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        #home-page { display: flex; }

        header { text-align: center; margin-bottom: 10px; }
        h1 { font-weight: 300; font-size: 1.8rem; letter-spacing: 6px; margin: 0; }

        /* åˆ‡æ›é–‹é—œå€åŸŸ */
        .settings-area { display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px; width: 100%; align-items: center; }
        .toggle-btn {
            display: flex; align-items: center; gap: 10px; padding: 12px 25px;
            background: var(--white); border-radius: 50px; width: 80%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid rgba(185, 155, 107, 0.1);
        }
        .toggle-label { font-size: 0.9rem; letter-spacing: 1px; flex-grow: 1; }

        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .nav-btn {
            background: var(--white) !important; border: 1px solid rgba(185, 155, 107, 0.15);
            border-radius: 25px; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            color: var(--text-main) !important; box-shadow: 0 8px 20px rgba(93, 82, 69, 0.08);
            cursor: pointer; transition: transform 0.2s;
        }
        .menu-btn { aspect-ratio: 1 / 1.15; font-size: 1.1rem; }
        .menu-btn span { font-size: 2.5rem; margin-bottom: 10px; }

        /* å‘¼å¸èˆ‡å€’æ•¸æ ¸å¿ƒå€ */
        .breath-area { position: relative; width: 160px; height: 160px; margin-bottom: 30px; display: flex; align-items: center; justify-content: center; }
        .breath-circle { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #F2D388 0%, transparent 70%); border-radius: 50%; filter: blur(12px); animation: breathe 8s ease-in-out infinite; }
        #timer-display { font-size: 2.2rem; font-weight: 300; color: var(--accent-soft); z-index: 2; }

        .step-box { min-height: 180px; text-align: center; cursor: pointer; width: 100%; }
        .sense-tag { font-size: 0.85rem; color: var(--accent-soft); letter-spacing: 4px; margin-bottom: 20px; font-weight: bold; }
        .step-text { font-size: 1.3rem; line-height: 1.8; letter-spacing: 1px; }

        @keyframes breathe { 0%, 100% { transform: scale(0.8); opacity: 0.3; } 50% { transform: scale(1.3); opacity: 0.7; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .footer-hint { font-size: 0.85rem; opacity: 0.5; margin-top: 20px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div id="home-page" class="page">
        <header><h1>Angel</h1></header>
        
        <div class="settings-area">
            <div class="toggle-btn" onclick="toggleVoice()">
                <span id="voice-icon">ğŸ”Š</span>
                <span class="toggle-label" id="voice-text">èªéŸ³å°å¼•ï¼šé–‹å•Ÿ</span>
            </div>
            <div class="toggle-btn" onclick="toggleAuto()">
                <span id="auto-icon">â³</span>
                <span class="toggle-label" id="auto-text">è‡ªå‹•è¨ˆæ™‚ï¼šé–‹å•Ÿ</span>
            </div>
        </div>

        <div class="menu-grid">
            <button class="nav-btn menu-btn" onclick="start('kids')"><span>ğŸ¨</span>å°å°å­©</button>
            <button class="nav-btn menu-btn" onclick="start('primary')"><span>ğŸ’</span>å­©å­å€‘</button>
            <button class="nav-btn menu-btn" onclick="start('teen')"><span>ğŸ§</span>é’å°‘å¹´</button>
            <button class="nav-btn menu-btn" onclick="start('adult')"><span>ğŸŒ¿</span>çµ¦è‡ªå·±</button>
        </div>
        <p class="footer-hint">éš¨æ©Ÿå¼•å° Â· äº”æ„Ÿèåˆ</p>
    </div>

    <div id="content-page" class="page">
        <div class="breath-area">
            <div class="breath-circle"></div>
            <div id="timer-display"></div>
        </div>
        <div class="step-box" id="step-box" onclick="manualNext()">
            </div>
        <div id="page-hint" class="footer-hint"></div>
        <button id="finish-btn" class="nav-btn" style="display:none; width:100%; height:60px; font-weight:bold; margin-top: 20px;" onclick="location.reload()">å›åˆ°ç”Ÿæ´»</button>
    </div>
</div>

<script>
    const pool = {
        kids: [[{s:"ğŸ‘€ è¦–è¦º", t:"å¿ƒè£¡ç¾åœ¨æ˜¯ä»€éº¼é¡è‰²ï¼Ÿ"}, {s:"âœ‹ è§¸è¦º", t:"æƒ³åƒé€™é¡è‰²åƒæ£‰èŠ±ç³–ä¸€æ¨£è»Ÿã€‚"}, {s:"ğŸŒ¬ï¸ å—…è¦º", t:"èèçœ‹ï¼Œå®ƒæœ‰è‰è“çš„å‘³é“å—ï¼Ÿ"}]],
        primary: [[{s:"ğŸ‘‚ è½è¦º", t:"è½è½çœ‹ï¼Œç’°å¢ƒè£¡æœ€é çš„è²éŸ³ã€‚"}, {s:"ğŸ‘€ è¦–è¦º", t:"æ‰¾æ‰¾çœ‹ï¼Œä¸‰å€‹è—è‰²çš„æ±è¥¿ã€‚"}, {s:"ğŸ§˜ ç©©å®š", t:"æ„Ÿè¦ºè…³è¶¾é ­æŠ“åœ°çš„åŠ›é‡ã€‚"}]],
        teen: [[{s:"âœ‹ è§¸è¦º", t:"æ‘¸æ‘¸è¡£æœï¼Œæ˜¯ç²—ç³™é‚„æ˜¯æŸ”è»Ÿï¼Ÿ"}, {s:"ğŸ‘ƒ å—…è¦º", t:"æ„Ÿè¦ºæ¶¼æ¶¼çš„ç©ºæ°£é€²åˆ°é¼»è…”ã€‚"}, {s:"ğŸ§  è¦ºå¯Ÿ", t:"æˆ‘ç¾åœ¨çš„å®‰å…¨æ„Ÿåœ¨å“ªè£¡ï¼Ÿ"}]],
        adult: [[{s:"ğŸŒ ç©ºé–“", t:"é€™ä»½æƒ…ç·’æ˜¯å±¬æ–¼ç¾åœ¨å—ï¼Ÿ"}, {s:"ğŸ‘‚ è½è¦º", t:"è½è½å‘¼å¸ï¼Œæ˜¯æ€¥ä¿ƒé‚„æ˜¯å¹³ç·©ï¼Ÿ"}, {s:"ğŸŒ¿ æ•´åˆ", t:"çœ‹è¦‹åè¦‹ï¼Œä½†æˆ‘é¸æ“‡æº«å’Œå°å¾…ã€‚"}]],
    };

    let isVoiceEnabled = true;
    let isAutoEnabled = true;
    let currentSteps = [];
    let currentIdx = 0;
    let timerInterval;

    function toggleVoice() {
        isVoiceEnabled = !isVoiceEnabled;
        document.getElementById('voice-icon').innerText = isVoiceEnabled ? "ğŸ”Š" : "ğŸ”‡";
        document.getElementById('voice-text').innerText = `èªéŸ³å°å¼•ï¼š${isVoiceEnabled ? 'é–‹å•Ÿ' : 'é—œé–‰'}`;
    }

    function toggleAuto() {
        isAutoEnabled = !isAutoEnabled;
        document.getElementById('auto-icon').innerText = isAutoEnabled ? "â³" : "ğŸ–±ï¸";
        document.getElementById('auto-text').innerText = `è‡ªå‹•è¨ˆæ™‚ï¼š${isAutoEnabled ? 'é–‹å•Ÿ' : 'é—œé–‰'}`;
    }

    function start(type) {
        const options = pool[type];
        currentSteps = options[Math.floor(Math.random() * options.length)];
        currentIdx = 0;
        document.getElementById('home-page').style.display = 'none';
        document.getElementById('content-page').style.display = 'flex';
        runStep();
    }

    function runStep() {
        if (currentIdx >= currentSteps.length) { finish(); return; }
        const item = currentSteps[currentIdx];
        document.getElementById('step-box').innerHTML = `
            <div class="sense-tag">${item.s}</div>
            <div class="step-text">${item.t.replace(/ï¼Œ/g, '<br>')}</div>
        `;
        
        if (isVoiceEnabled) speak(item.t);

        if (isAutoEnabled) {
            document.getElementById('page-hint').innerText = "è‡ªå‹•å¼•å°ä¸­...";
            startTimer(10, () => { currentIdx++; runStep(); });
        } else {
            document.getElementById('timer-display').innerText = "â€”";
            document.getElementById('page-hint').innerText = "æº–å‚™å¥½å¾Œï¼Œè¼•è§¸æ–‡å­—ç¹¼çºŒ";
        }
    }

    function manualNext() {
        if (!isAutoEnabled && currentIdx < currentSteps.length) {
            currentIdx++;
            runStep();
        }
    }

    function startTimer(seconds, callback) {
        let timeLeft = seconds;
        const display = document.getElementById('timer-display');
        display.innerText = timeLeft;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--; display.innerText = timeLeft;
            if (timeLeft <= 0) { clearInterval(timerInterval); callback(); }
        }, 1000);
    }

    function speak(content) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(content);
        utterance.lang = 'zh-TW'; utterance.rate = 0.8;
        window.speechSynthesis.speak(utterance);
    }

    function finish() {
        clearInterval(timerInterval);
        document.getElementById('timer-display').innerText = "âœ¨";
        document.getElementById('step-box').innerHTML = `<div class="sense-tag">ç·´ç¿’é”æˆ</div><div class="step-text">è¬è¬ä½ ï¼Œé™ªè‡ªå·±èµ°äº†é€™æ®µè·¯ã€‚</div>`;
        document.getElementById('page-hint').innerText = "";
        document.getElementById('finish-btn').style.display = 'block';
    }
</script>
</body>
</html>

