<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Angel-åè¦‹è¦ºå¯Ÿ</title>
    <style>
        :root {
            --bg-deep: #3D523D;
            --text-light: #F2E9E1;
            --accent-gold: #F2D388;
            --card-glass: rgba(255, 255, 255, 0.1);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; font-family: -apple-system, "PingFang TC", sans-serif;
            height: 100dvh; background-color: var(--bg-deep);
            color: var(--text-light); display: flex; justify-content: center; overflow: hidden;
        }
        .container { 
            width: 100%; max-width: 450px; height: 100%; 
            padding: 15px 20px; display: flex; flex-direction: column; 
            justify-content: space-between; /* ç¢ºä¿é ‚éƒ¨èˆ‡åº•éƒ¨æ’é–‹ */
        }
        .page { width: 100%; display: none; flex-direction: column; align-items: center; }
        
        /* é é ­ç¸®å°é¿å…æ“ å£“ */
        header h1 { font-weight: 200; font-size: 1.8rem; letter-spacing: 8px; color: var(--accent-gold); margin: 5px 0; }
        .intro-text { font-size: 0.8rem; opacity: 0.7; line-height: 1.5; margin-bottom: 10px; text-align: center; }

        /* é¸é …å€ç·Šæ¹ŠåŒ– */
        .section-label { font-size: 0.75rem; letter-spacing: 1px; margin: 8px 0 4px; opacity: 0.6; align-self: flex-start; }
        .option-row {
            width: 100%; background: var(--card-glass); border-radius: 50px;
            padding: 3px; display: flex; border: 1px solid rgba(255,255,255,0.1);
        }
        .opt-item { flex: 1; text-align: center; font-size: 0.75rem; cursor: pointer; opacity: 0.4; padding: 8px 0; border-radius: 30px; transition: 0.2s; }
        .opt-item.active { opacity: 1; background: var(--accent-gold); color: var(--bg-deep); font-weight: bold; }

        /* æŒ‰éˆ•å€ */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; margin-top: 10px; }
        .nav-btn { background: var(--card-glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; color: var(--text-light); cursor: pointer; padding: 15px; }
        .menu-btn { font-size: 0.9rem; letter-spacing: 2px; }
        .menu-btn span { font-size: 1.8rem; display: block; margin-bottom: 3px; }

        /* ç·´ç¿’ä¸­é é¢ */
        .breath-circle { 
            width: 120px; height: 120px; background: radial-gradient(circle, var(--accent-gold) 0%, transparent 70%); 
            border-radius: 50%; filter: blur(8px); animation: breathe 8s infinite; margin: 30px 0;
            display: flex; align-items: center; justify-content: center;
        }
        #timer-display { font-size: 2rem; filter: blur(0); }
        .step-box { min-height: 140px; text-align: center; width: 100%; }
        .step-text { font-size: 1.25rem; line-height: 1.8; letter-spacing: 1px; }

        .journal-box { width: 100%; margin-top: 10px; }
        .journal-input { width: 100%; background: var(--card-glass); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 12px; border-radius: 15px; outline: none; }

        @keyframes breathe { 0%, 100% { transform: scale(0.9); opacity: 0.3; } 50% { transform: scale(1.2); opacity: 0.6; } }
    </style>
</head>
<body>

<audio id="bg-music" loop playsinline></audio>
<audio id="bell-sound" playsinline></audio>

<div class="container">
    <div id="home-page" class="page" style="display: flex;">
        <header><h1>Angel</h1><div class="intro-text">ç•¶ä½ æ„Ÿåˆ°åè¦‹æˆ–ç…©èºæ™‚ï¼Œ<br>èˆ‡æ„Ÿå®˜é€£çµï¼Œæ‰¾å›å…§åœ¨å¹³éœã€‚</div></header>

        <div class="section-label">èˆ’ç·©æ°›åœéŸ³</div>
        <div class="option-row" id="music-row">
            <div class="opt-item active" onclick="cfgSet('music','none')">å¯‚éœ</div>
            <div class="opt-item" onclick="cfgSet('music','sea')">æ·±æµ·</div>
            <div class="opt-item" onclick="cfgSet('music','wind')">å¾®é¢¨</div>
            <div class="opt-item" onclick="cfgSet('music','zen')">ç¦ªå®š</div>
        </div>

        <div class="section-label">æ¯é¡Œåœç•™ç§’æ•¸</div>
        <div class="option-row" id="time-row">
            <div class="opt-item active" onclick="cfgSet('time',10)">10s</div>
            <div class="opt-item" onclick="cfgSet('time',20)">20s</div>
            <div class="opt-item" onclick="cfgSet('time',30)">30s</div>
        </div>

        <div class="section-label">æç¤ºéŸ³æ•ˆ (æ›é¡Œæ™‚)</div>
        <div class="option-row" id="bell-row">
            <div class="opt-item active" onclick="cfgSet('bell','bowl')">é Œç¼½</div>
            <div class="opt-item" onclick="cfgSet('bell','chime')">æœ¨éˆ´</div>
            <div class="opt-item" onclick="cfgSet('bell','mute')">ç„¡è²</div>
        </div>

        <div class="menu-grid">
            <button class="nav-btn menu-btn" onclick="start('kids')"><span>ğŸ¨</span>å°å°å­©</button>
            <button class="nav-btn menu-btn" onclick="start('adult')"><span>ğŸŒ¿</span>çµ¦è‡ªå·±</button>
        </div>
        
        <div style="font-size: 0.7rem; margin: 15px 0 5px; opacity: 0.4; text-align: center;">
            <a href="https://forms.gle/your-id" style="color: white; text-decoration: none;">ğŸ“‹ ä½¿ç”¨å›é¥‹</a>
        </div>
    </div>

    <div id="content-page" class="page">
        <div class="breath-circle"><div id="timer-display"></div></div>
        <div class="step-box" id="step-box"></div>
        <div id="journal-area" class="journal-box" style="display:none;">
            <textarea class="journal-input" id="note" rows="3" placeholder="ç·´ç¿’çµæŸï¼Œæ­¤åˆ»çš„å¿ƒæƒ…..."></textarea>
            <button class="nav-btn" style="width:100%; margin-top:10px; background:var(--accent-gold); color:var(--bg-deep); font-weight:bold;" onclick="location.reload()">å„²å­˜ä¸¦å®Œæˆ</button>
        </div>
    </div>
</div>

<script>
    // ä½¿ç”¨å…¨ MP3 æ ¼å¼ï¼Œç¢ºä¿ iOS 100% ç›¸å®¹
    const musicLib = {
        none: "",
        sea: "https://assets.mixkit.co/music/preview/mixkit-deep-ocean-hum-1549.mp3", 
        wind: "https://www.soundjay.com/nature/wind-01.mp3",
        zen: "https://assets.mixkit.co/music/preview/mixkit-dreaming-big-31.mp3"
    };

    const bellLib = {
        bowl: "https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3", // ç¦ªæ„é Œç¼½æ„Ÿ
        chime: "https://www.soundjay.com/misc/sounds/magic-chime-01.mp3",
        mute: ""
    };

    const pool = {
        kids: [{s:"ğŸ‘€ è¦–è¦º", t:"çœ‹çœ‹çª—å¤–ï¼Œæ‰¾ä¸€å€‹ç¶ è‰²çš„æ±è¥¿ã€‚"}, {s:"âœ‹ è§¸è¦º", t:"æ‘¸æ‘¸è‡ªå·±çš„æ‰‹å¿ƒï¼Œæ˜¯æš–æš–çš„å—ï¼Ÿ"}, {s:"ğŸŒ¬ï¸ å—…è¦º", t:"æ·±å‘¼å¸ï¼Œèèç©ºæ°£çš„å‘³é“ã€‚"}],
        adult: [{s:"ğŸŒ ç©ºé–“", t:"æ„Ÿè¦ºèº«é«”è¢«æ¤…å­æ”¯æ’çš„åŠ›é‡ã€‚"}, {s:"ğŸ‘‚ è½è¦º", t:"ç•™æ„æˆ¿é–“å…§æœ€å¾®å¼±çš„è²éŸ³ã€‚"}, {s:"ğŸŒ¿ æ•´åˆ", t:"å°è‡ªå·±èªªï¼šæˆ‘ç¾åœ¨å¾ˆå®‰å…¨ã€‚"}]
    };

    let cfg = { music: 'none', time: 10, bell: 'bowl' };
    let stepIdx = 0;

    function cfgSet(type, val) {
        cfg[type] = val;
        const rowId = type + '-row';
        const items = document.getElementById(rowId).getElementsByClassName('opt-item');
        for (let item of items) {
            item.classList.remove('active');
            if (item.innerText.toLowerCase().includes(val.toString().toLowerCase())) item.classList.add('active');
            if (val === 'none' && item.innerText === 'å¯‚éœ') item.classList.add('active');
            if (val === 'bowl' && item.innerText === 'é Œç¼½') item.classList.add('active');
            if (val === 'zen' && item.innerText === 'ç¦ªå®š') item.classList.add('active');
        }
    }

    function start(type) {
        // ã€æ ¸å¿ƒè§£é–ã€‘é»æ“Šç¬é–“å¼·åˆ¶å•Ÿå‹•éŸ³è¨Šä¸Šä¸‹æ–‡
        const music = document.getElementById('bg-music');
        const bell = document.getElementById('bell-sound');
        
        if(cfg.music !== 'none') {
            music.src = musicLib[cfg.music];
            music.load();
            music.play().catch(() => {}); 
        }
        
        if(cfg.bell !== 'mute') {
            bell.src = bellLib[cfg.bell];
            bell.load();
            // é ç†±æ’­æ”¾
            bell.play().then(()=> {bell.pause(); bell.currentTime=0;}).catch(()=>{});
        }

        document.getElementById('home-page').style.display = 'none';
        document.getElementById('content-page').style.display = 'flex';
        run(pool[type]);
    }

    function run(steps) {
        if(stepIdx >= steps.length) { 
            document.getElementById('step-box').innerHTML = "ç·´ç¿’å®Œæˆ âœ¨";
            document.getElementById('journal-area').style.display = 'block';
            return; 
        }
        
        const item = steps[stepIdx];
        document.getElementById('step-box').innerHTML = `<div class="sense-tag">${item.s}</div><div class="step-text">${item.t}</div>`;
        
        // æç¤ºéŸ³
        if(cfg.bell !== 'mute') {
            const b = document.getElementById('bell-sound');
            b.play().catch(()=>{});
        }

        // èªéŸ³å°å¼•
        const u = new SpeechSynthesisUtterance(item.t);
        u.lang = 'zh-TW'; u.rate = 0.8;
        window.speechSynthesis.speak(u);

        let count = cfg.time;
        document.getElementById('timer-display').innerText = count;
        let timer = setInterval(() => {
            count--;
            document.getElementById('timer-display').innerText = count > 0 ? count : "âœ¨";
            if(count <= 0) { clearInterval(timer); stepIdx++; run(steps); }
        }, 1000);
    }
</script>
</body>
</html>
