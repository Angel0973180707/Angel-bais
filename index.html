<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Angel-åè¦‹è¦ºå¯Ÿ</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3D523D">
    <style>
        :root {
            --bg-deep: #3D523D;
            --text-light: #F2E9E1;
            --accent-gold: #F2D388;
            --card-glass: rgba(255, 255, 255, 0.08);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; font-family: "PingFang TC", "Noto Sans TC", sans-serif;
            height: 100dvh; background-color: var(--bg-deep) !important;
            color: var(--text-light) !important; display: flex; justify-content: center; overflow: hidden;
        }
        .container { 
            width: 100%; max-width: 480px; height: 100dvh; 
            padding: 20px 25px; display: flex; flex-direction: column; 
            align-items: center; justify-content: space-between; 
            padding-bottom: calc(env(safe-area-inset-bottom) + 30px); 
        }
        .page { width: 100%; animation: fadeIn 0.8s ease; display: none; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        #home-page { display: flex; }

        header h1 { font-weight: 200; font-size: 2rem; letter-spacing: 8px; margin-bottom: 5px; color: var(--accent-gold); }

        .settings-area { width: 100%; display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px; align-items: center; }
        
        /* å››å­—éŸ³æ¨‚é¸æ“‡å™¨ - æ’ç‰ˆæ•´é½Š */
        .music-selector {
            width: 95%; background: var(--card-glass); border-radius: 50px;
            padding: 5px; display: flex; justify-content: space-between;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .music-opt { flex: 1; text-align: center; font-size: 0.8rem; cursor: pointer; opacity: 0.5; padding: 10px 0; border-radius: 40px; transition: 0.3s; color: var(--text-light); letter-spacing: 1px; }
        .music-opt.active { opacity: 1; background: var(--accent-gold); color: var(--bg-deep); font-weight: bold; }

        .toggle-btn {
            display: flex; align-items: center; gap: 12px; padding: 12px 25px;
            background: var(--card-glass); border-radius: 50px; width: 95%;
            cursor: pointer; border: 1px solid rgba(255,255,255,0.1);
        }
        .toggle-label { font-size: 0.9rem; letter-spacing: 2px; flex-grow: 1; }

        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .nav-btn {
            background: var(--card-glass) !important; border: 1px solid rgba(255,255,255,0.15);
            border-radius: 30px; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            color: var(--text-light) !important; cursor: pointer; transition: 0.2s;
        }
        .menu-btn { aspect-ratio: 1 / 1.1; font-size: 1.1rem; letter-spacing: 2px; }
        .menu-btn span { font-size: 2.5rem; margin-bottom: 10px; }

        .breath-area { position: relative; width: 160px; height: 160px; margin-bottom: 40px; display: flex; align-items: center; justify-content: center; }
        .breath-circle { 
            position: absolute; width: 100%; height: 100%; 
            background: radial-gradient(circle, var(--accent-gold) 0%, transparent 75%); 
            border-radius: 50%; filter: blur(15px); animation: breathe 8s ease-in-out infinite; 
        }
        #timer-display { font-size: 2.5rem; font-weight: 200; color: var(--text-light); z-index: 2; }

        .step-box { min-height: 200px; text-align: center; width: 100%; z-index: 2; }
        .sense-tag { font-size: 0.9rem; color: var(--accent-gold); letter-spacing: 5px; margin-bottom: 25px; opacity: 0.8; }
        .step-text { font-size: 1.4rem; line-height: 2.2; letter-spacing: 3px; font-weight: 300; }

        @keyframes breathe { 0%, 100% { transform: scale(0.8); opacity: 0.2; } 50% { transform: scale(1.4); opacity: 0.5; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .footer-hint { font-size: 0.8rem; opacity: 0.4; margin-top: 20px; letter-spacing: 2px; }
    </style>
</head>
<body>

<audio id="bg-music" loop></audio>

<div class="container">
    <div id="home-page" class="page">
        <header><h1>Angel</h1></header>
        
        <div class="settings-area">
            <div class="music-selector">
                <div class="music-opt active" id="m-none" onclick="selectMusic('none')">ä¿æŒå¯‚éœ</div>
                <div class="music-opt" id="m-deep" onclick="selectMusic('deep')">æ·±åº¦é »ç‡</div>
                <div class="music-opt" id="m-relax" onclick="selectMusic('relax')">èˆ’ç·©æ³¢éŸ³</div>
                <div class="music-opt" id="m-focus" onclick="selectMusic('focus')">å¹³éœå¿ƒæµ</div>
            </div>
            <div class="toggle-btn" onclick="toggleVoice()">
                <span id="voice-icon">ğŸ”Š</span>
                <span class="toggle-label" id="voice-text">èªéŸ³å°å¼•ï¼šé–‹å•Ÿ</span>
            </div>
            <div class="toggle-btn" onclick="toggleAuto()">
                <span id="auto-icon">â³</span>
                <span class="toggle-label" id="auto-text">è‡ªå‹•è¨ˆæ™‚ï¼šé–‹å•Ÿ</span>
            </div>
        </div>

        <div class="menu-grid">
            <button class="nav-btn menu-btn" onclick="start('kids')"><span>ğŸ¨</span>å°å°å­©</button>
            <button class="nav-btn menu-btn" onclick="start('primary')"><span>ğŸ’</span>å­©å­å€‘</button>
            <button class="nav-btn menu-btn" onclick="start('teen')"><span>ğŸ§</span>é’å°‘å¹´</button>
            <button class="nav-btn menu-btn" onclick="start('adult')"><span>ğŸŒ¿</span>çµ¦è‡ªå·±</button>
        </div>
        <p class="footer-hint">è¦ºå¯Ÿç©ºé–“ Â· å…§åœ¨ç©©å®š</p>
    </div>

    <div id="content-page" class="page">
        <div class="breath-area">
            <div class="breath-circle"></div>
            <div id="timer-display"></div>
        </div>
        <div class="step-box" id="step-box" onclick="manualNext()"></div>
        <div id="page-hint" class="footer-hint"></div>
        <button id="finish-btn" class="nav-btn" style="display:none; width:100%; height:60px; font-weight:bold; margin-top: 30px;" onclick="stopPractice()">çµæŸç·´ç¿’</button>
    </div>
</div>

<script>
    const musicLibrary = {
        none: "",
        // ä½¿ç”¨ Pixabay æˆ– SoundHelix çš„ç„¡ä¾µæ¬Šé »ç‡éŸ³æ¨‚
        deep: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3", 
        relax: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3", 
        focus: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-16.mp3"
    };

    const pool = {
        kids: [
            [{s:"ğŸ‘€ è¦–è¦º", t:"é–‰ä¸Šçœ¼ï¼Œå¿ƒè£¡ç¾åœ¨æ˜¯ä»€éº¼é¡è‰²ï¼Ÿ"}, {s:"âœ‹ è§¸è¦º", t:"æƒ³åƒé€™é¡è‰²åƒæ£‰èŠ±ç³–ä¸€æ¨£è»Ÿã€‚"}, {s:"ğŸŒ¬ï¸ å—…è¦º", t:"èèçœ‹ï¼Œå®ƒæœ‰è‰è“çš„å‘³é“å—ï¼Ÿ"}],
            [{s:"ğŸ‘‚ è½è¦º", t:"è½è½è…¦è¢‹è£¡ï¼Œæœ‰æ²’æœ‰å°ç²¾éˆåœ¨å”±æ­Œï¼Ÿ"}, {s:"âœ‹ è§¸è¦º", t:"æ‘¸æ‘¸è‚šå­ï¼Œæ„Ÿè¦ºå®ƒåƒæ°£çƒä¸€æ¨£å‹•ã€‚"}, {s:"ğŸ‘€ è¦–è¦º", t:"æƒ³åƒå¿ƒè£¡æœ‰ä¸€é“å½©è™¹äº®èµ·ä¾†äº†ã€‚"}],
            [{s:"ğŸ‘€ è¦–è¦º", t:"çœ‹è‘—å‰æ–¹ï¼Œæ‰¾å‡ºä¸€ä»¶æœ€äº®çš„æ±è¥¿ã€‚"}, {s:"ğŸ‘ƒ å—…è¦º", t:"æ·±å¸ä¸€å£æ°£ï¼Œèåˆ°æ£®æ—çš„å‘³é“å—ï¼Ÿ"}, {s:"âœ‹ è§¸è¦º", t:"æŠ±æŠ±è‡ªå·±ï¼Œæ„Ÿè¦ºèº«é«”æš–æš–çš„ã€‚"}]
        ],
        primary: [
            [{s:"ğŸ‘‚ è½è¦º", t:"è½è½çœ‹ï¼Œç’°å¢ƒè£¡æœ€é çš„ä¸€å€‹è²éŸ³ã€‚"}, {s:"ğŸ‘€ è¦–è¦º", t:"æ‰¾æ‰¾çœ‹ï¼Œæˆ¿é–“è£¡ä¸‰å€‹è—è‰²çš„æ±è¥¿ã€‚"}, {s:"ğŸ§˜ ç©©å®š", t:"æ„Ÿè¦ºè…³è¶¾é ­ç”¨åŠ›æŠ“åœ°çš„åŠ›é‡ã€‚"}],
            [{s:"âœ‹ è§¸è¦º", t:"æ‘¸æ‘¸èº«é‚Šçš„ç‰©å“ï¼Œå®ƒæ˜¯æ¶¼çš„é‚„æ˜¯ç†±çš„ï¼Ÿ"}, {s:"ğŸ‘‚ è½è¦º", t:"è½è½çœ‹ï¼Œé›¢ä½ æœ€è¿‘çš„ä¸€å€‹è²éŸ³ã€‚"}, {s:"ğŸ§˜ ç©©å®š", t:"æ„Ÿè¦ºé›™æ‰‹æ”¾åœ¨å¤§è…¿ä¸Šï¼Œæ²ˆæ²ˆçš„é‡é‡ã€‚"}],
            [{s:"ğŸ‘€ è¦–è¦º", t:"é–‰ä¸Šçœ¼ï¼Œæƒ³åƒæœ‰ä¸€æ»´æ°´æ»´å…¥æ¹–é¢ã€‚"}, {s:"ğŸ‘‚ è½è¦º", t:"å°ˆæ³¨è½è‡ªå·±çš„å‘¼å¸è²ï¼Œåƒæµ·æµªå—ï¼Ÿ"}, {s:"ğŸ§˜ ç©©å®š", t:"æ„Ÿè¦ºè„Šæ¤åƒå°æ¨¹ä¸€æ¨£ï¼Œæ…¢æ…¢é•·é«˜ã€‚"}]
        ],
        teen: [
            [{s:"âœ‹ è§¸è¦º", t:"æ‘¸æ‘¸è¡£æœï¼Œæ˜¯ç²—ç³™é‚„æ˜¯æŸ”è»Ÿï¼Ÿ"}, {s:"ğŸ‘ƒ å—…è¦º", t:"æ„Ÿè¦ºå†·ç©ºæ°£é€²åˆ°é¼»è…”ã€‚"}, {s:"ğŸ§  è¦ºå¯Ÿ", t:"æˆ‘ç¾åœ¨çš„å®‰å…¨æ„Ÿï¼Œåœ¨å“ªè£¡ï¼Ÿ"}],
            [{s:"ğŸ‘‚ è½è¦º", t:"æš«æ™‚è½è½ï¼Œç’°å¢ƒåŸæœ¬çš„èƒŒæ™¯å™ªéŸ³ã€‚"}, {s:"ğŸ‘€ è¦–è¦º", t:"æ³¨è¦–ä¸€å€‹é»ï¼Œè§€å¯Ÿå®ƒçš„å…‰å½±è®ŠåŒ–ã€‚"}, {s:"ğŸ§  è¦ºå¯Ÿ", t:"å¦‚æœæƒ…ç·’æœ‰åå­—ï¼Œå®ƒç¾åœ¨å«ä»€éº¼ï¼Ÿ"}],
            [{s:"âœ‹ è§¸è¦º", t:"æ„Ÿå—æ‰‹æ©Ÿæˆ–æ¡Œé¢ï¼ŒæŒ‡å°–å‚³ä¾†çš„è³ªåœ°ã€‚"}, {s:"ğŸŒ¬ï¸ å‘¼å¸", t:"å¸æ°£ 4 ç§’ï¼Œæ„Ÿè¦ºèƒ¸è…”æ“´å¼µçš„ç©ºé–“ã€‚"}, {s:"ğŸ§  è¦ºå¯Ÿ", t:"é€™ä»½å£“åŠ›ï¼Œæ˜¯æˆ‘çš„é‚„æ˜¯åˆ¥äººçš„ï¼Ÿ"}]
        ],
        adult: [
            [{s:"ğŸŒ ç©ºé–“", t:"é€™ä»½æƒ…ç·’ï¼Œæ˜¯å±¬æ–¼ç¾åœ¨çš„å—ï¼Ÿ"}, {s:"ğŸ‘‚ è½è¦º", t:"è½è½å‘¼å¸ï¼Œæ˜¯æ€¥ä¿ƒé‚„æ˜¯å¹³ç·©ï¼Ÿ"}, {s:"ğŸŒ¿ æ•´åˆ", t:"çœ‹è¦‹åè¦‹ï¼Œä½†æˆ‘é¸æ“‡æº«å’Œå°å¾…ã€‚"}],
            [{s:"âœ‹ è§¸è¦º", t:"æ„Ÿè¦ºè…³æŒèˆ‡åœ°é¢æ¥è§¸çš„æ¯å€‹éƒ¨ä½ã€‚"}, {s:"ğŸ‘€ è¦–è¦º", t:"ç’°é¡§å››å‘¨ï¼Œç¢ºèªæˆ‘ç¾åœ¨æ˜¯å®‰å…¨çš„ã€‚"}, {s:"ğŸŒ¿ æ•´åˆ", t:"å…è¨±æ··äº‚å­˜åœ¨ï¼Œæˆ‘ä¸å¿…ç«‹åˆ»è§£æ±ºã€‚"}],
            [{s:"ğŸŒ ç©ºé–“", t:"æ„Ÿè¦ºèº«é«”åœ¨æ¤…å­ä¸Šï¼Œè¢«æ”¯æ’çš„åŠ›é‡ã€‚"}, {s:"ğŸ‘‚ è½è¦º", t:"ç•™æ„ç©ºé–“ä¸­ï¼Œè¢«éºå¿˜çš„å¾®å°è²éŸ³ã€‚"}, {s:"ğŸŒ¿ æ•´åˆ", t:"æ„Ÿè¬è‡ªå·±ï¼Œé¡˜æ„åœä¸‹ä¾†è¦ºå¯Ÿã€‚"}]
        ]
    };

    let selectedMusic = 'none';
    let isVoiceEnabled = true;
    let isAutoEnabled = true;
    let currentSteps = [];
    let currentIdx = 0;
    let timerInterval;

    function selectMusic(type) {
        selectedMusic = type;
        document.querySelectorAll('.music-opt').forEach(opt => opt.classList.remove('active'));
        document.getElementById(`m-${type}`).classList.add('active');
    }

    function toggleVoice() {
        isVoiceEnabled = !isVoiceEnabled;
        document.getElementById('voice-icon').innerText = isVoiceEnabled ? "ğŸ”Š" : "ğŸ”‡";
        document.getElementById('voice-text').innerText = `èªéŸ³å°å¼•ï¼š${isVoiceEnabled ? 'é–‹å•Ÿ' : 'é—œé–‰'}`;
    }

    function toggleAuto() {
        isAutoEnabled = !isAutoEnabled;
        document.getElementById('auto-icon').innerText = isAutoEnabled ? "â³" : "ğŸ–±ï¸";
        document.getElementById('auto-text').innerText = `è‡ªå‹•è¨ˆæ™‚ï¼š${isAutoEnabled ? 'é–‹å•Ÿ' : 'é—œé–‰'}`;
    }

    function start(type) {
        currentSteps = pool[type][Math.floor(Math.random() * pool[type].length)];
        currentIdx = 0;
        const music = document.getElementById('bg-music');
        if (selectedMusic !== 'none') {
            music.src = musicLibrary[selectedMusic];
            music.volume = 0.3;
            music.play().catch(e => console.log("ç­‰å¾…æ‰‹å‹•é»æ“Šå•Ÿå‹•éŸ³è»Œ"));
        }
        document.getElementById('home-page').style.display = 'none';
        document.getElementById('content-page').style.display = 'flex';
        runStep();
    }

    function runStep() {
        if (currentIdx >= currentSteps.length) { finish(); return; }
        const item = currentSteps[currentIdx];
        document.getElementById('step-box').innerHTML = `
            <div class="sense-tag">${item.s}</div>
            <div class="step-text">${item.t.replace(/ï¼Œ/g, '<br>')}</div>
        `;
        if (isVoiceEnabled) speak(item.t);
        if (isAutoEnabled) {
            document.getElementById('page-hint').innerText = "è‡ªå‹•å¼•å°ä¸­...";
            startTimer(10, () => { currentIdx++; runStep(); });
        } else {
            document.getElementById('timer-display').innerText = "â€”";
            document.getElementById('page-hint').innerText = "æº–å‚™å¥½å¾Œï¼Œè¼•è§¸æ–‡å­—ç¹¼çºŒ";
        }
    }

    function manualNext() {
        if (!isAutoEnabled && currentIdx < currentSteps.length) { currentIdx++; runStep(); }
    }

    function startTimer(seconds, callback) {
        let timeLeft = seconds;
        document.getElementById('timer-display').innerText = timeLeft;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--; document.getElementById('timer-display').innerText = timeLeft;
            if (timeLeft <= 0) { clearInterval(timerInterval); callback(); }
        }, 1000);
    }

    function speak(content) {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(content);
        u.lang = 'zh-TW'; u.rate = 0.75; window.speechSynthesis.speak(u);
    }

    function finish() {
        clearInterval(timerInterval);
        document.getElementById('timer-display').innerText = "âœ¨";
        document.getElementById('step-box').innerHTML = `<div class="sense-tag">ç·´ç¿’é”æˆ</div><div class="step-text">è¬è¬ä½ ï¼Œé™ªè‡ªå·±èµ°äº†é€™æ®µè·¯ã€‚<br>å¹³éœå°±åœ¨ä½ çš„å¿ƒè£¡ã€‚</div>`;
        document.getElementById('page-hint').innerText = "";
        document.getElementById('finish-btn').style.display = 'block';
    }

    function stopPractice() {
        document.getElementById('bg-music').pause();
        location.reload();
    }
</script>
</body>
</html>
